<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta author="pfraze">
        <title>Link - Inbox Example</title>
        <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css" />
        <script src="link.js"></script>
        <script src="tint.js"></script>
    </head>
    <body onload="app_init()">
        <div id="layout">
            <div id="nav" class="well"></div>
            <div id="content">Loading...</div>
        </div>

        <script id="nav-template" type="text/html">
            <ul class="nav nav-list">
                $item() {
                $header(label) {<li class="nav-header">$label;</li>}header;
                $link(label, icon, uri) {<li><a href="$uri;"><i class="icon-$icon;"></i> $label;</a></li>}link;
                }item;
            </ul>
        </script>

        <script id="inbox-template" type="text/html">
            <div class="toolbar">
                <form method="get">
                    <button class="btn" formaction="$inbox_uri;" title="Check for new messages"><i class="icon-refresh"></i></button>
                </form>
            </div>
            <table class="table table-condensed">
                $message(service, uri, title, date){
                <tr><td><span class="label">$service;</span></td><td><a href="$uri;">$title;</a></td><td>$date;</td></tr>
                }message;
            </table>
        </script>

        <script id="message-template" type="text/html">
            <h3 style="margin-bottom:5px">$subject;</h3>
            <p> 
                <small>
                    Sent on <span class="label">$date; @$time;</span>
                    by <span class="label">$author;</span>
                    to $recp(){
                    $add(name){<span class="label">$name;,</span>}add;
                    $last(name){<span class="label">$name;</span>}last;
                    }recp;
                </small>
            </p>
            <hr />
            <p>$body;</p>
        </script>
        
        <script>
            var Modules = {};
            var Views = {};
        </script>
        <script src="inbox/views.js"></script>
        <script src="inbox/layout.js"></script>
        <script src="inbox/inbox.js"></script>
        <script src="inbox/nav.js"></script>
        <script src="inbox/services/fixture.js"></script>
        <script src="inbox/services/remotefixture.js"></script>
        <script>
            function app_init() {
                // Service configuration
                var services = {
                    local:{ module:Modules.FixtureService, name:'Fixture' },
                    remote:{ module:Modules.RemoteFixtureService, name:'Remote' }
                };                    
            
                // Create mediators
                var app = new Link.Mediator();
                var nav = new Link.Mediator('nav');
                var content = new Link.Mediator('content');
            
                // Configure modules
                app.addModule('#', new Modules.Layout(nav, content));
                nav.addModule('#', new Modules.Nav(services));
                content.addModule('#', new Modules.Inbox());
                for (var uri in services) {
                    var mod = services[uri].module;
                    var inst = new mod(services[uri].name);
                    content.addModule('#/services/' + uri, inst);
                }
                
                // Start application
                Link.logMode('traffic', true);
                Link.attachToWindow(app);
            };
        </script>
    </body>
</html>
